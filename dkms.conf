local base_dir="$dkms_tree/$module/$module_version/$kernelver/$arch"

# The dynamically generated DKMS configuration file name. This gets sourced by
# the top DKMS configuration file (this file), if it exists (see end of this
# script). It defines all the built modules depending on the kernel version or
# configuration options of medial_build.
#
# This dynamically generated DKMS configuration file is generated by a post
# build command script (gen_dkms_dyn_conf.sh).
#
# It is important, that it exists when the DKMS install command is executed.
local dkms_dyn_conf="$base_dir/dkms_dyn.conf"

# The module directory, where DKMS stores the built modules after the build.
local dkms_mod_dir="$base_dir/module"

PACKAGE_NAME=media_build
PACKAGE_VERSION=0.1.0
AUTOINSTALL=y
MAKE[0]="VER=$kernelver ./build_all.sh dummy -db"
CLEAN="VER=$kernelver ./build_all.sh dummy -dc"
POST_BUILD="./gen_dkms_dyn_conf.sh ${dkms_mod_dir} $dkms_dyn_conf"
CHECK_MODULE_VERSION=n

# There have to be at least one module defined in the top DKMS configuration
# file, otherwise DKMS throws an error.
BUILT_MODULE_NAME[0]=dvb-core
BUILT_MODULE_LOCATION[0]=./v4l
DEST_MODULE_LOCATION[0]=/updates/dkms

# Source the dynamically generated DKMS configuration file.
if [ -e $dkms_dyn_conf ]; then
   . $dkms_dyn_conf
fi
